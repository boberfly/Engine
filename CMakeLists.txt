CMAKE_MINIMUM_REQUIRED(VERSION 3.2.3)

SET(CMAKE_POSITION_INDEPENDENT_CODE ON)

SET(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake ${CMAKE_MODULE_PATH})
SET(ENGINE_ROOT ${CMAKE_CURRENT_SOURCE_DIR})
SET(ENGINE_SRC_PATH ${ENGINE_ROOT}/src)
SET(ENGINE_RES_PATH ${ENGINE_ROOT}/res)
SET(ENGINE_3RDPARTY_PATH ${ENGINE_ROOT}/3rdparty)
SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

# Engine project is C++
PROJECT(Engine)

INCLUDE(configs)
INCLUDE(projects)

# Setup option
OPTION(ENGINE_BUILD_GPU_D3D12 "Build Direct3D 12 backend." ON)
OPTION(ENGINE_THEFORGE_VLK "Build The-Forge Vulkan backend." OFF)
OPTION(ENGINE_THEFORGE_DX11 "Build The-Forge Direct3D 11 backend." OFF)
OPTION(ENGINE_THEFORGE_DX12 "Build The-Forge Direct3D 12 backend." OFF)
OPTION(ENGINE_THEFORGE_MTL "Build The-Forge Metal backend." OFF)

# Setup ISPC
SET(ISPC_TARGETS avx2)
SET(ENABLE_ISPC_SUPPORT YES)
INCLUDE(ispc)

# Output directories.
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/output/lib)
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/output/lib)
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/output/bin)

# Add third party libraries.
ADD_SUBDIRECTORY("3rdparty")

# Enable Remotery DLL support for debug & optimized.
ADD_DEFINITIONS(-DRMT_DLL=1)

SET_PROPERTY( DIRECTORY APPEND PROPERTY COMPILE_DEFINITIONS $<$<CONFIG:Debug>:DEBUG> $<$<CONFIG:Debug>:RMT_ENABLED=1> )
SET_PROPERTY( DIRECTORY APPEND PROPERTY COMPILE_DEFINITIONS $<$<CONFIG:Optimized>:OPTIMIZED> $<$<CONFIG:Optimized>:RMT_ENABLED=1> $<$<CONFIG:Optimized>:NDEBUG> )


# Version.
SET(ENGINE_MAJOR_VERSION 0)
SET(ENGINE_MINOR_VERSION 0)
SET(ENGINE_MICRO_VERSION 0)
SET(ENGINE_VERSION "${ENGINE_MAJOR_VERSION}.${ENGINE_MINOR_VERSION}.${ENGINE_MICRO_VERSION}")

IF(MSVC)
	# Setup warning level.
    ADD_DEFINITIONS(/W4)		# level 4
    ADD_DEFINITIONS(/WX)		# warnings as errors
    ADD_DEFINITIONS(/wd4100)	# disable unreferenced formal parameter
ENDIF()

INCLUDE_DIRECTORIES(
	"${ENGINE_SRC_PATH}"

	# 3rdparty.
	"${ENGINE_3RDPARTY_PATH}/Remotery/lib"
)

ADD_SUBDIRECTORY("src")
ADD_SUBDIRECTORY("apps")
